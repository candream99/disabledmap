<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„¤ì´ë²„ ë²¡í„°ë§µ í…ŒìŠ¤íŠ¸ (feat. í˜¸ë­ì´) - ì¸µë³„ ê¸°ëŠ¥ ì¶”ê°€</title>
    <style>
        body { margin: 0; padding: 0; height: 100vh; font-family: 'Malgun Gothic', sans-serif; }
        #map { width: 100%; height: 100%; }
        #status {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 99, 71, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        #coordDisplay {
            position: absolute;
            top: 50px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: #FFC107;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            min-width: 250px;
            text-align: center;
        }

        /* â­ ì¸µë³„ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ ì¶”ê°€ â­ */
        #floorControls {
            position: absolute;
            top: 10px;
            right: 10px; /* ì˜¤ë¥¸ìª½ ìƒë‹¨ì— ë°°ì¹˜ */
            z-index: 1000;
            display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ (ì‹¤ë‚´ ëª¨ë“œ ì§„ì… ì‹œ í‘œì‹œ) */
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            padding: 5px;
        }

        /* â­ ì¸µë³„ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì¶”ê°€ â­ */
        .floor-btn {
            background: #f0f0f0;
            color: #333;
            border: 1px solid #ccc;
            padding: 8px 12px;
            margin: 0 2px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            font-weight: bold;
        }

        .floor-btn.active {
            background: #4A90E2; /* ì„ íƒëœ ë²„íŠ¼ ìƒ‰ìƒ */
            color: white;
            border-color: #4A90E2;
        }

        .floor-btn:not(.active):hover {
            background: #e0e0e0;
        }
    </style>
</head>
<body>
    <div id="status">API í‚¤ í™•ì¸ ì¤‘...</div>
    <div id="coordDisplay">ì§€ë„ë¥¼ í´ë¦­í•˜ë©´ ì¢Œí‘œê°€ ë‚˜ì™€ìš”!</div>
    <div id="map"></div>
    
    <div id="floorControls">
        <button class="floor-btn" id="btnB1" data-floor="B1">B1</button>
        <button class="floor-btn" id="btn1F" data-floor="1F">1F</button>
        <button class="floor-btn" id="btn2F" data-floor="2F">2F</button>
    </div>
    
    <script>
        const NCP_KEY_ID = 'q1d23mmkof';
        
        // â­ ì¸µë³„ ì´ë¯¸ì§€ URL ì •ì˜ (í˜„ì¬ëŠ” ëª¨ë‘ ky_1.jpg ì‚¬ìš©) â­
        const floorImageUrls = {
            'B1': 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/ky_1.jpg',
            '1F': 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/ky_1.jpg',
            '2F': 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/ky_1.jpg'
        };
        
        const floorControls = document.getElementById('floorControls');
        const floorButtons = document.querySelectorAll('.floor-btn');

        let map;
        let groundOverlay = null;
        let labelLayer;
        let imageBounds; // ì´ë¯¸ì§€ ê²½ê³„ë¥¼ ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸
        let polygon; // ë‹¤ê°í˜• ê°ì²´ë¥¼ ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸

        const script = document.createElement('script');
        script.src = `https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=${NCP_KEY_ID}&vmode=3`;
        script.onload = function() {
            document.getElementById('status').textContent = 'API ë¡œë“œ ì„±ê³µ!\në²¡í„° ì§€ë„ ì´ˆê¸°í™” ì¤‘...'; 
            document.getElementById('status').style.background = 'rgba(60, 179, 113, 0.9)';
            
            // ì´ë¯¸ì§€ ê²½ê³„ ì •ì˜ (ê¸°ì¡´ ì½”ë“œì—ì„œ GroundOverlay ìƒì„± ì „ì— í•„ìš”í•˜ë¯€ë¡œ ì•ìœ¼ë¡œ ëºŒ)
            const swLatLng = new naver.maps.LatLng(37.570535, 126.977631); // ë‚¨ì„œìª½ (ì¢Œì¸¡ í•˜ë‹¨)
            const neLatLng = new naver.maps.LatLng(37.571365, 126.978099); // ë¶ë™ìª½ (ìš°ì¸¡ ìƒë‹¨)
            imageBounds = new naver.maps.LatLngBounds(swLatLng, neLatLng);


            // ì§€ë„ ì´ˆê¸° ì˜µì…˜ ì„¤ì •
            const mapOptions = {
                center: new naver.maps.LatLng(37.570946, 126.97788),
                zoom: 18,
                zoomControl: true,
                zoomControlOptions: {
                    position: naver.maps.Position.TOP_RIGHT
                },
                mapTypes: new naver.maps.MapTypeRegistry({
                    'normal': naver.maps.NaverStyleMapTypeOptions.getVectorMap()
                })
            };
            map = new naver.maps.Map('map', mapOptions);
            map.setMapTypeId('normal');

            // ë¼ë²¨ ë ˆì´ì–´ ì„¤ì • 
            labelLayer = new naver.maps.LabelLayer();
            labelLayer.setMap(map);

            document.getElementById('status').style.display = 'none';
            
            // -------------------------------------------------------------------
            // â­â­ ë‹¤ê°í˜•(Polygon) ê¸°ëŠ¥ â­â­
            // -------------------------------------------------------------------

            const polygonCoords = [
                new naver.maps.LatLng(37.571348, 126.977671),
                new naver.maps.LatLng(37.571354, 126.978059),
                new naver.maps.LatLng(37.570541, 126.978091),
                new naver.maps.LatLng(37.570538, 126.977698)
            ];
            polygon = new naver.maps.Polygon({
                map: map,
                paths: [polygonCoords],
                fillColor: 'transparent',
                fillOpacity: 0.5,
                strokeColor: '#C490E4',
                strokeOpacity: 1,
                strokeWeight: 3,
                clickable: true 
            });
            
            // ë§ˆìš°ìŠ¤ ì˜¤ë²„(Hover) íš¨ê³¼
            naver.maps.Event.addListener(polygon, 'mouseover', function() {
                polygon.setOptions({
                    fillColor: '#C490E4'
                });
                document.getElementById('coordDisplay').textContent = 'ì—¬ê¸°ëŠ” ë‹¤ê°í˜• ë‚´ë¶€ì…ë‹ˆë‹¤! (ë§ˆìš°ìŠ¤ ì˜¤ë²„)';
            });

            // ë§ˆìš°ìŠ¤ ì•„ì›ƒ ì‹œ
            naver.maps.Event.addListener(polygon, 'mouseout', function() {
                if (!groundOverlay || groundOverlay.getMap() === null) { 
                    polygon.setOptions({
                        fillColor: 'transparent'
                    });
                    document.getElementById('coordDisplay').textContent = 'ì§€ë„ë¥¼ í´ë¦­í•˜ë©´ ì¢Œí‘œê°€ ë‚˜ì™€ìš”!';
                }
            });

            // -------------------------------------------------------------------
            // â­â­ GroundOverlay(í‰ë©´ë„) ë° ì¸µë³„ ì œì–´ ê¸°ëŠ¥ â­â­
            // -------------------------------------------------------------------
            
            // GroundOverlay ê°ì²´ ìƒì„± í•¨ìˆ˜ (ì´ì „ì— ìƒì„±ë˜ì§€ ì•Šì•˜ì„ ê²½ìš°ì—ë§Œ ìƒì„±)
            function createGroundOverlay() {
                if (!groundOverlay) {
                    // GroundOverlayëŠ” ìµœì´ˆ 1íšŒë§Œ ìƒì„±í•˜ê³  URLê³¼ ë§µë§Œ ë³€ê²½í•©ë‹ˆë‹¤.
                    groundOverlay = new naver.maps.GroundOverlay(floorImageUrls['1F'], imageBounds, {
                        map: null, 
                        clickable: true, 
                        opacity: 1
                    });
                    
                    // ğŸŒŸ GroundOverlay í´ë¦­ ì´ë²¤íŠ¸: ì´ë¯¸ì§€ í´ë¦­ ì‹œ ì œê±° (ì‹¤ë‚´ ëª¨ë“œ ì¢…ë£Œ)
                    naver.maps.Event.addListener(groundOverlay, 'click', function(e) {
                        e.stopOverlays = true; 
                        
                        // ì‹¤ë‚´ ëª¨ë“œ ì¢…ë£Œ
                        groundOverlay.setMap(null); 
                        labelLayer.setMap(map); // ë¼ë²¨ ë‹¤ì‹œ ë³´ì´ê²Œ ì„¤ì •
                        floorControls.style.display = 'none'; // â­ ì¸µë³„ ë²„íŠ¼ ìˆ¨ê¹€ â­
                        polygon.setOptions({
                            fillColor: 'transparent' 
                        });
                        document.getElementById('coordDisplay').textContent = 'ì§€ë„ë¥¼ í´ë¦­í•˜ë©´ ì¢Œí‘œê°€ ë‚˜ì™€ìš”!';
                        console.log("í‰ë©´ë„ í´ë¦­: ì‹¤ë‚´ ëª¨ë“œ ì¢…ë£Œ. ì§€ë„ ë¼ë²¨ ë³µêµ¬.");
                    });
                }
            }

            // â­ ì¸µë³„ í‰ë©´ë„ë¥¼ í‘œì‹œí•˜ëŠ” í•µì‹¬ í•¨ìˆ˜ â­
            function showFloor(floor) {
                // GroundOverlay ê°ì²´ê°€ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ìƒì„±í•©ë‹ˆë‹¤.
                createGroundOverlay();

                // 1. GroundOverlayì˜ ì´ë¯¸ì§€ URL ë³€ê²½
                groundOverlay.setOptions({
                    url: floorImageUrls[floor]
                });
                
                // 2. ë§µì— í‘œì‹œ
                if (groundOverlay.getMap() === null) {
                     groundOverlay.setMap(map);
                }

                // 3. ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
                floorButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`#btn${floor}`).classList.add('active');

                document.getElementById('coordDisplay').textContent = `ğŸ¢ ì‹¤ë‚´ ëª¨ë“œ í™œì„±í™”: ${floor}ì¸µ. ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ë©´ ì¼ë°˜ ì§€ë„ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.`;
                console.log(`ì¸µ ë³€ê²½: ${floor}`);
            }

            // â­ ì¸µë³„ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ â­
            floorButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const floor = this.getAttribute('data-floor');
                    showFloor(floor);
                });
            });


            // ë‹¤ê°í˜•(Polygon) í´ë¦­ ì´ë²¤íŠ¸ ìˆ˜ì •: ì‹¤ë‚´ ëª¨ë“œ ì§„ì…
            naver.maps.Event.addListener(polygon, 'click', function(e) {
                e.stopOverlays = true; // ë‹¤ê°í˜• ë‚´ë¶€ í´ë¦­ ì‹œ ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸ ì „íŒŒ ì¤‘ë‹¨

                // ì‹¤ë‚´ ëª¨ë“œ ì‹œì‘
                labelLayer.setMap(null); // ë¼ë²¨ ìˆ¨ê¹€ ì„¤ì •
                floorControls.style.display = 'flex'; // â­ ì¸µë³„ ë²„íŠ¼ í‘œì‹œ â­
                polygon.setOptions({
                    fillColor: '#C490E4' 
                });
                
                // â­â­ ì‹¤ë‚´ ëª¨ë“œ ì§„ì… ì‹œ 1Fë¥¼ ê¸°ë³¸ìœ¼ë¡œ í‘œì‹œ â­â­
                showFloor('1F'); 

                console.log("ë‹¤ê°í˜• ë‚´ë¶€ í´ë¦­: ì‹¤ë‚´ ëª¨ë“œ ì§„ì…. ì§€ë„ ë¼ë²¨ ìˆ¨ê¹€.");
            });

            // â­ ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸ (ë‹¤ê°í˜• ë°–ì„ í´ë¦­í–ˆì„ ë•Œë§Œ ì‘ë™)
            naver.maps.Event.addListener(map, 'click', function(e) {
                if (!groundOverlay || groundOverlay.getMap() === null) {
                    const lat = e.latlng.lat().toFixed(6);
                    const lng = e.latlng.lng().toFixed(6);
                    document.getElementById('coordDisplay').textContent = `ìœ„ë„: ${lat}, ê²½ë„: ${lng}`;
                    console.log(`í´ë¦­ëœ ì¢Œí‘œ: ìœ„ë„ ${lat}, ê²½ë„ ${lng}`);
                } else {
                    console.log("ì‹¤ë‚´ ëª¨ë“œ ì¤‘: ì§€ë„ í´ë¦­ ë¬´ì‹œë¨.");
                }
            });

            console.log("ë„¤ì´ë²„ ë²¡í„°ë§µ ë¡œë“œ ë° ì´ˆê¸°í™” ì„±ê³µ! ì¸µë³„ ì œì–´ ê¸°ëŠ¥ ì¶”ê°€ë¨.");
        };
        script.onerror = function() {
            document.getElementById('status').textContent = 'API ë¡œë“œ ì‹¤íŒ¨!\në„¤ì´ë²„ Key ID ë˜ëŠ” ì›¹ ì„œë¹„ìŠ¤ URLì„ í™•ì¸í•´ì£¼ì„¸ìš”. ã… ã… ';
            document.getElementById('status').style.background = 'red';
            console.error("ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ ì‹¤íŒ¨!");
        };
        document.head.appendChild(script);
    </script>
</body>
</html>
