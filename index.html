<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë„¤ì´ë²„ ë²¡í„°ë§µ í…ŒìŠ¤íŠ¸ - ë¬´ì¥ì•  ì‹œì„¤ íŒì—… ìµœì¢…ë³¸ (í†µí•©)</title>
    <style>
        /* ------------------------------------------------ */
        /* ê¸°ë³¸/ê³µí†µ ìŠ¤íƒ€ì¼ */
        /* ------------------------------------------------ */
        body { 
            [cite_start]margin: 0; [cite: 1]
            [cite_start]padding: 0; [cite: 2] 
            height: 100vh; [cite_start]/* ë·°í¬íŠ¸ ë†’ì´ë¡œ ê³ ì • */ [cite: 2]
            font-family: 'Malgun Gothic', sans-serif;
            overflow: hidden; [cite_start]/* í˜ì´ì§€ ìì²´ì˜ ìŠ¤í¬ë¡¤ì„ ì™„ì „íˆ ë§‰ìŒ */ [cite: 3]
        }
        [cite_start]#map { width: 100%; [cite: 4]
            height: 100%; [cite_start]} [cite: 4]

        /* ê²€ìƒ‰ì°½ ìŠ¤íƒ€ì¼ */
        #searchBox {
            position: absolute;
            [cite_start]top: 20px; [cite: 5]
            left: 50%;
            transform: translateX(-50%);
            width: 80vw; 
            max-width: 500px; 
            height: 48px;
            background: #ffffff;
            border-radius: 24px;
            [cite_start]box-shadow: 0 6px 16px rgba(0,0,0,0.2); [cite: 6]
            display: flex;
            align-items: center;
            padding: 0 15px; 
            [cite_start]z-index: 2000; [cite: 7]
        }
        
        /* coordDisplay ìŠ¤íƒ€ì¼ (ê³µí†µ) */
        #coordDisplay {
            position: absolute;
            [cite_start]left: 50%; [cite: 13]
            transform: translateX(-50%);
            [cite_start]width: 80vw; [cite: 13]
            [cite_start]max-width: 500px; [cite: 14]
            [cite_start]height: 24px; [cite: 14]
            [cite_start]background: rgba(255, 255, 255, 0.9); [cite: 15]
            [cite_start]color: #000000; [cite: 16]
            border-radius: 24px;
            [cite_start]display: flex; [cite: 16]
            [cite_start]justify-content: center; [cite: 17]
            [cite_start]align-items: center; [cite: 17]
            padding: 0 15px; 
            font-size: 14px;
            z-index: 1500;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2); 
            transition: all 0.3s ease;
            [cite_start]white-space: nowrap; [cite: 18]
            [cite_start]overflow: hidden; [cite: 19]
            text-overflow: ellipsis;
            min-width: unset; 
        }

        /* ê³µí†µ ì›í˜• ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .map-btn-circle {
            [cite_start]width: 40px; [cite: 20]
            [cite_start]height: 40px; [cite: 20]
            padding: 0;
            cursor: pointer;
            background: #ffffff;
            border: none; 
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            color: #000;
            [cite_start]font-weight: normal; [cite: 21]
            font-size: 14px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            [cite_start]line-height: 1; [cite: 22]
        }
        
        /* ì¸µ ë²„íŠ¼/ì•¡ì„¸ìŠ¤ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ê³µí†µ ì›í˜• ìŠ¤íƒ€ì¼ ìƒì†) */
        .floor-btn {
            [cite_start]font-size: 14px; [cite: 33]
        }

        /* ------------------------------------------------ */
        /* ğŸ–¥ï¸ ë°ìŠ¤í¬í†± ìŠ¤íƒ€ì¼ (769px ì´ìƒ) - ë²„íŠ¼ ìœ„ì¹˜ ìš°ì¸¡ìœ¼ë¡œ ë³€ê²½ */
        /* ------------------------------------------------ */
        @media screen and (min-width: 769px) {
            
            /* í˜„ì¬ ìœ„ì¹˜ ë²„íŠ¼ ìœ„ì¹˜ ë³€ê²½ (ìš°ì¸¡ í•˜ë‹¨) */
            #geolocationBtn {
                bottom: 30px; 
                right: 30px;
                left: auto; /* ê¸°ì¡´ left ì†ì„± ë¬´ì‹œ */
            }

            /* ì¸µ ì»¨íŠ¸ë¡¤ ì»¨í…Œì´ë„ˆ ìœ„ì¹˜ ë³€ê²½ (ìš°ì¸¡ í•˜ë‹¨ ìœ„) */
            #floorControls {
                bottom: 80px; 
                right: 30px;
                left: auto; /* ê¸°ì¡´ left ì†ì„± ë¬´ì‹œ */
                flex-direction: column-reverse; [cite_start]/* ëª¨ë°”ì¼ê³¼ ë™ì¼í•˜ê²Œ ì•„ë˜ì„œ ìœ„ë¡œ ìŒ“ìŒ */ [cite: 31]
            }
            
            /* ë¬´ì¥ì•  íŒì—… ìŠ¤íƒ€ì¼ ìˆ˜ì • (ìš°ì¸¡ ì •ë ¬) */
            #accessPopup {
                /* top: auto; (JSì—ì„œ ì„¤ì •ë¨) */
                right: 80px; /* ìš°ì¸¡ ë²„íŠ¼ ì˜ì—­ì—ì„œ ë„ì›€ */
                left: auto; /* JSì—ì„œ ìœ„ì¹˜ ê³„ì‚°í•˜ì§€ ì•ŠìŒ */
                max-width: 300px; /* ë°ìŠ¤í¬í†±ì—ì„œ ì¡°ê¸ˆ ë” ë„“ê²Œ */
            }
        }

        /* ------------------------------------------------ */
        /* ğŸ“± ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ (768px ì´í•˜) - ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
        /* ------------------------------------------------ */
        @media screen and (max-width: 768px) {
            
            /* coordDisplay ì¼ë°˜ ëª¨ë“œ ìœ„ì¹˜ (searchBox ì•„ë˜) */
            #coordDisplay.outdoor-mode-coord {
                [cite_start]top: 78px; [cite: 12]
            }

            /* í˜„ì¬ ìœ„ì¹˜ ë²„íŠ¼ ìœ„ì¹˜ ìœ ì§€ (ì¢Œì¸¡ í•˜ë‹¨) */
            #geolocationBtn {
                position: absolute;
                [cite_start]bottom: 18px; [cite: 23]
                left: 10px;
                z-index: 1500;
            }

            /* ì¸µ ì»¨íŠ¸ë¡¤ ì»¨í…Œì´ë„ˆ ìœ„ì¹˜ ìœ ì§€ (ì¢Œì¸¡ í•˜ë‹¨ ìœ„) */
            #floorControls {
                position: absolute;
                [cite_start]bottom: 88px; [cite: 31]
                left: 10px;
                [cite_start]flex-direction: column-reverse; [cite: 31]
            }
            
            /* ë¬´ì¥ì•  íŒì—… ìŠ¤íƒ€ì¼ ìœ ì§€ (JSì—ì„œ ì™¼ìª½ ìœ„ì¹˜ ê³„ì‚°, í•˜ë‹¨ ê³ ì •) */
            #accessPopup {
                left: auto; 
                [cite_start]width: 90%; [cite: 40, 41]
                [cite_start]max-width: 240px; [cite: 42]
                /* JSì—ì„œ bottom: 20px ë° left ê³„ì‚° ì ìš©ë¨ */
            }
        }


        /* ------------------------------------------------ */
        /* ë‚˜ë¨¸ì§€ ìŠ¤íƒ€ì¼ (ë³€í™” ì—†ìŒ) */
        /* ------------------------------------------------ */
        #floorControls {
            [cite_start]display: none; [cite: 31]
            [cite_start]gap: 8px; [cite: 31]
            z-index: 1500;
            background: transparent;
            padding: 0;
            [cite_start]box-shadow: none; [cite: 32]
        }
        #accessInfoBtn {
            [cite_start]margin-bottom: 18px; [cite: 34]
            [cite_start]font-size: 0; [cite: 35]
            line-height: 0; 
        }
        /* ... ê¸°íƒ€ ìƒì„¸ ìŠ¤íƒ€ì¼ ìƒëµ (ì½”ë“œ ê¸¸ì´ ìƒ, ìœ„ì— ì œê³µëœ ì›ë³¸ ìŠ¤íƒ€ì¼ì„ ê·¸ëŒ€ë¡œ ìœ ì§€) ... */
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div id="searchBox">
        <button id="hamburgerBtn" title="ë©”ë‰´">
            <span class="burger-line"></span>
            <span class="burger-line"></span>
            <span class="burger-line"></span>
        </button>
        <div id="searchPlaceholder">ê±´ë¬¼ì´ë¦„ì„ ê²€ìƒ‰í•˜ì„¸ìš”</div>
    </div>
    
    <div id="coordDisplay" 
class="outdoor-mode-coord">ê±´ë¬¼ì„ 
[cite_start][cite: 61] í´ë¦­í•˜ë©´ ì‹¤ë‚´ì§€ë„ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”</div>
    
 
    <button id="geolocationBtn" class="map-btn-circle" title="í˜„ì¬ ìœ„ì¹˜ ì°¾ê¸°"><span class="geo-icon"></span></button>
    
    <div id="floorControls">
        <button id="accessInfoBtn" class="floor-btn map-btn-circle" data-floor="access" title="ë¬´ì¥ì•  ì‹œì„¤ ì •ë³´"><span class="i-icon"></span></button>
        </div>

    <div id="accessPopup" style="display:none;">
        <span id="accessPopupClose" style="position:absolute; top:6px; right:10px; font-size:22px; cursor:pointer;
color:#777;">Ã—</span>
        
        <div id="accessPopupBody">
            <div id="buildingInfoSection" class="popup-section">
 
[cite_start][cite: 62]                </div>
            
            <div id="accessFacilitySection" class="popup-section">
                </div>
        </div>
  
    </div>

    <script>
        
        [cite_start]const NCP_KEY_ID = 'q1d23mmkof'; [cite: 63]
        const script = document.createElement('script');
        script.src = `https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=${NCP_KEY_ID}&vmode=3`;

        script.onload = function () {
            // ì „ì—­ DOM ìš”ì†Œ ë³€ìˆ˜
            [cite_start]const mapContainer = document.getElementById('map'); [cite: 64]
            [cite_start]const searchBox = document.getElementById('searchBox'); [cite: 64]
            const coordDisplay = document.getElementById('coordDisplay');
            const floorControlsContainer = document.getElementById('floorControls');
            [cite_start]const popup = document.getElementById('accessPopup'); [cite: 65]
            [cite_start]const buildingInfoSection = document.getElementById('buildingInfoSection'); [cite: 66]
            [cite_start]const accessFacilitySection = document.getElementById('accessFacilitySection'); [cite: 66]
            const accessBtn = document.getElementById('accessInfoBtn');
            const popupClose = document.getElementById('accessPopupClose');
            [cite_start]const geolocationBtn = document.getElementById('geolocationBtn'); [cite: 67]
            
            [cite_start]let groundOverlay = null; [cite: 75]
            [cite_start]let currentBuildingId = null; [cite: 75]
            [cite_start]let currentPositionMarker = null; [cite: 75]
            
            // ---------------------------------------------------------
            // ğŸš¨ í™˜ê²½ ê°ì§€ í•¨ìˆ˜ (í•µì‹¬ ë¡œì§ ë¶„ë¦¬ ê¸°ì¤€)
            // ---------------------------------------------------------
            function isMobile() {
                // í™”ë©´ ë„ˆë¹„ ê¸°ë°˜ ê°ì§€ (CSS Media Queryì™€ ì¼ì¹˜)
                return window.innerWidth <= 768;
                
                /*
                // User Agent ê¸°ë°˜ ê°ì§€ë¥¼ ì›í•  ê²½ìš° ì•„ë˜ ì½”ë“œë¥¼ ì‚¬ìš©
                const userAgent = navigator.userAgent || navigator.vendor || window.opera;
                return /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent);
                */
            }


            // =========================================================
            // ë¹Œë”©ë³„ ë°ì´í„° ì •ì˜ (ë°ì´í„° ë³€í™” ì—†ìŒ)
            // =========================================================
            const buildings = {
                [cite_start]// ... (ì›ë³¸ ì½”ë“œ [cite: 76][cite_start]ë¶€í„° [cite: 96]ê¹Œì§€ì˜ buildings ê°ì²´ ë°ì´í„°ëŠ” ì—¬ê¸°ì— ê·¸ëŒ€ë¡œ ì‚½ì…) ...
                'ky': { // ê±´ë¬¼ 1 (ì˜ˆì‹œ: ê²½í¬ê¶)
                    polygonCoords: [
                        new naver.maps.LatLng(37.571350, 126.977670),
                        new naver.maps.LatLng(37.571360, 126.978059),
                        new naver.maps.LatLng(37.571275, 126.978063),
                        [cite_start]new naver.maps.LatLng(37.571275, 126.978173), [cite: 78]
                        new naver.maps.LatLng(37.570870, 126.978184),
                        new naver.maps.LatLng(37.570872, 126.978082),
                        new naver.maps.LatLng(37.570543, 126.978094),
                        [cite_start]new naver.maps.LatLng(37.570539, 126.977702), [cite: 79]
                    ],
                    floors: ['b1', '1f', '2f'],
                    images: {
                        [cite_start]'b1': 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/ky_1.jpg', [cite: 80]
                        '1f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/ky11.png', 
                        '2f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/ky_1.jpg',
                    },
                    imageBounds: new naver.maps.LatLngBounds(
                        new naver.maps.LatLng(37.570512, 126.977632), 
                        [cite_start]new naver.maps.LatLng(37.571415, 126.978244)  [cite: 82]
                    ),
                    currentFloor: '1f', 
                    polygon: null,
                    accessInfo: {
                        [cite_start]'ì£¼ì¶œì…êµ¬ ê²½ì‚¬ë¡œ': true, [cite: 83]
                        'ì¥ì• ì¸ í™”ì¥ì‹¤': true,
                        'ì§•ì• ì¸ ì£¼ì°¨ì¥': true,
                        'ì—˜ë¦¬ë² ì´í„°': true,
                        [cite_start]'ì£¼ì¶œì…êµ¬ ë‹¨ì°¨': false [cite: 84]
                    },
                    buildingInfo: {
                        [cite_start]name: 'êµë³´ë¹Œë”©', [cite: 85]
                        image_url: 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/kyobo_gwanghwamun.jpg', 
                        address: 'ì„œìš¸ ì¢…ë¡œêµ¬ ìƒˆë¬¸ì•ˆë¡œ 45',
                        [cite_start]operating_hours: '09:00 - 18:00 (ì›”ìš”ì¼ íœ´ë¬´)' [cite: 86]
                    }
                },
                [cite_start]'dt': { // ê±´ë¬¼ 2 (ì˜ˆì‹œ: ëˆì˜ë¬¸) [cite: 87]
                    polygonCoords: [
                        new naver.maps.LatLng(37.571470, 126.978762),
                        new naver.maps.LatLng(37.571476, 126.979161),
                        [cite_start]new naver.maps.LatLng(37.570627, 126.979181), [cite: 88]
                        new naver.maps.LatLng(37.570557, 126.979117),
                        [cite_start]new naver.maps.LatLng(37.570553, 126.978777), [cite: 89]
                    ],
                    floors: ['b4', '1f'], 
                    images: {
                        'b4': 'https://raw.githubusercontent.com/candream99/disabledmap/main/dt/dt_b4.png',
                        [cite_start]'1f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/dt/dt1.png', [cite: 90]
                    },
                    imageBounds: new naver.maps.LatLngBounds(
                        new naver.maps.LatLng(37.570459, 126.978649), 
                        [cite_start]new naver.maps.LatLng(37.571626, 126.979210)  [cite: 91]
                    ),
                    currentFloor: '1f',
                    polygon: null,
                    [cite_start]accessInfo: { [cite: 92]
                        'ì£¼ì¶œì…êµ¬ ê²½ì‚¬ë¡œ': false,
                        'ì¥ì• ì¸ í™”ì¥ì‹¤': true, 
                        [cite_start]'ì¥ì• ì¸ ì£¼ì°¨ì¥': false, [cite: 93]
                        'ì—˜ë¦¬ë² ì´í„°': true,
                        'ì£¼ì¶œì…êµ¬ ë‹¨ì°¨': true 
                    },
                    buildingInfo: {
                        name: 'ê´‘í™”ë¬¸ Díƒ€ì›Œ',
                        image_url: 'https://raw.githubusercontent.com/candream99/disabledmap/main/dt/d_tower.jpg', 
                        [cite_start]address: 'ì„œìš¸ ì¢…ë¡œêµ¬ ì†¡ì›”ê¸¸ 2', [cite: 95]
                        operating_hours: '10:00 - 19:00 (ë§¤ì¼ ìš´ì˜)'
                    }
                [cite_start]} [cite: 96]
            };
            // =========================================================
            // ì§€ë„ ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • (ë‚´ë¶€ ë¡œì§ ë³€í™” ì—†ìŒ)
            // =========================================================
            
            // ì§€ë„ ì˜µì…˜
            const mapOptions = {
                center: new naver.maps.LatLng(37.5710, 126.9784),
                zoom: 17, 
                zoomControl: false, 
                [cite_start]scrollWheelZoom: false, [cite: 68]
                pinchZoom: true,
                mapTypes: new naver.maps.MapTypeRegistry({
                    [cite_start]normal: naver.maps.NaverStyleMapTypeOptions.getVectorMap(), [cite: 69]
                }),
            };
            
            // ì§€ë„ ì´ˆê¸°í™”
            [cite_start]const map = new naver.maps.Map('map', mapOptions); [cite: 70]
            [cite_start]map.setMapTypeId('normal'); [cite: 71]
            const labelLayer = new naver.maps.LabelLayer();
            labelLayer.setMap(map);

            // ë§ˆìš°ìŠ¤ íœ  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ë°ìŠ¤í¬í†± ì „ìš© ê¸°ëŠ¥)
            if (!isMobile()) {
                [cite_start]const ZOOM_STEP = 0.1; [cite: 72]
                mapContainer.addEventListener("wheel", function (e) {
                    [cite_start]e.preventDefault();     // ê¸°ë³¸ í™•ëŒ€/ì¶•ì†Œ ê¸ˆì§€ [cite: 72]

                    let currentZoom = map.getZoom();
                    let newZoom = currentZoom;

                    if (e.deltaY < 0) newZoom += ZOOM_STEP;   // í™•ëŒ€
                    else newZoom -= ZOOM_STEP;                [cite_start]// ì¶•ì†Œ [cite: 73]

                    newZoom = Math.round(newZoom * 100) / 100;

                    [cite_start]// ë„¤ì´ë²„ ì§€ë„ í—ˆìš© ë²”ìœ„ [cite: 74]
                    newZoom = Math.min(Math.max(newZoom, 1), 21);

                    map.setZoom(newZoom);
                [cite_start]}, { passive: false }); [cite: 74]
            }
            
            // ëª¨ë°”ì¼ í„°ì¹˜ ì´ë²¤íŠ¸ ë²„ë¸”ë§/ìŠ¤í¬ë¡¤ ë°©ì§€ (ëª¨ë°”ì¼ ì „ìš© ê¸°ëŠ¥)
            if (isMobile()) {
                function preventTouchMove(elementId) {
                    const element = document.getElementById(elementId);
                    [cite_start]if (element) { [cite: 98]
                        // í„°ì¹˜ ì´ë™(ë“œë˜ê·¸) ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ë¸Œë¼ìš°ì € ê¸°ë³¸ ë™ì‘ ë°©ì§€
                        element.addEventListener('touchmove', function(e) {
                            [cite_start]e.preventDefault(); [cite: 99]
                        [cite_start]}, { passive: false }); [cite: 99]
                    }
                }
                // ê²€ìƒ‰ì°½ê³¼ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í„°ì¹˜ ì´ë™ ì ê¸ˆ
                [cite_start]preventTouchMove('searchBox'); [cite: 99]
                [cite_start]preventTouchMove('floorControls'); [cite: 100]
            }

            // =========================================================
            // í•µì‹¬ ë¡œì§ í•¨ìˆ˜ (UI ê´€ë ¨ ë¶€ë¶„ë§Œ ì¼ë¶€ ìˆ˜ì •)
            // =========================================================
            
            /** ì‹¤ë‚´ ëª¨ë“œ ì§„ì… ì‹œ UI ë³€ê²½ */
            function enterIndoorMode(buildingId) {
                // ê²€ìƒ‰ì°½ ìˆ¨ê¸°ê¸°
                [cite_start]searchBox.style.display = 'none'; [cite: 101]
                // coordDisplayì˜ ìœ„ì¹˜ë¥¼ ìƒë‹¨(top: 10px)ìœ¼ë¡œ ì˜¬ë¦¼ (ê²€ìƒ‰ì°½ì´ ì‚¬ë¼ì§€ë¯€ë¡œ)
                [cite_start]coordDisplay.style.top = '10px'; [cite: 102]
                coordDisplay.classList.remove('outdoor-mode-coord'); // ì¼ë°˜ ëª¨ë“œ CSS ì œê±°

                const config = buildings[buildingId];
                if (config && config.polygonCoords && config.polygonCoords.length > 0) {
                    [cite_start]const bounds = new naver.maps.LatLngBounds(); [cite: 104]
                    [cite_start]config.polygonCoords.forEach(coord => bounds.extend(coord)); [cite: 105]
                    [cite_start]const centerPoint = bounds.getCenter(); [cite: 106]
                    [cite_start]map.setCenter(centerPoint); [cite: 106]
                    map.setZoom(18); [cite_start]// ìš”ì²­ëŒ€ë¡œ í•­ìƒ 18ë¡œ ê³ ì • [cite: 107]
                }
                [cite_start]currentBuildingId = buildingId; [cite: 107]
                [cite_start]labelLayer.setMap(null); [cite: 108]
                floorControlsContainer.style.display = 'flex';
                [cite_start]coordDisplay.textContent = 'ì¼ë°˜ì§€ë„ë¡œ ëŒì•„ê°€ë ¤ë©´ ì‹¤ë‚´ì§€ë„ë¥¼ í´ë¦­í•˜ì„¸ìš”'; [cite: 108]
            }

            /** ì‹¤ë‚´ ëª¨ë“œ ì¢…ë£Œ ì‹œ UI ë³€ê²½ */
            function exitIndoorMode() {
                [cite_start]if (!currentBuildingId) return; [cite: 110]
                if (groundOverlay) {
                    [cite_start]groundOverlay.setMap(null); [cite: 111]
                }
                
                // íŒì—…ì°½ ë‹«ê¸° ë° 'i' ë²„íŠ¼ active í•´ì œ
                [cite_start]popup.style.display = 'none'; [cite: 112]
                [cite_start]accessBtn.classList.remove('active'); [cite: 113]
                
                // ëª¨ë“  ê±´ë¬¼ í´ë¦¬ê³¤ ë³µì›
                for (const id in buildings) {
                    if (buildings[id].polygon) {
                        [cite_start]buildings[id].polygon.setMap(map); [cite: 114]
                        [cite_start]buildings[id].polygon.setOptions({ fillColor: 'transparent' }); [cite: 114]
                    }
                }
            
                [cite_start]floorControlsContainer.style.display = 'none'; [cite: 114]
                [cite_start]labelLayer.setMap(map); [cite: 115]
                [cite_start]currentBuildingId = null; [cite: 115]
            
                // ì¼ë°˜ ëª¨ë“œë¡œ ë³µê·€ ì‹œ UI ë³€ê²½
                [cite_start]searchBox.style.display = 'flex'; [cite: 116]
                // coordDisplay ìœ„ì¹˜ë¥¼ ê²€ìƒ‰ì°½ ì•„ë˜(top: 78px)ë¡œ ë³µì› (CSS í´ë˜ìŠ¤ í™œìš©)
                coordDisplay.style.top = '78px'; [cite_start]// [cite: 117]
                coordDisplay.classList.add('outdoor-mode-coord'); // ì¼ë°˜ ëª¨ë“œ CSS ë³µì›
                [cite_start]coordDisplay.textContent = 'ê±´ë¬¼ì„ í´ë¦­í•˜ë©´ ì‹¤ë‚´ì§€ë„ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”'; [cite: 117]
            }
            
            // * showFloor, renderFloorButtons, updateAccessPopup, setupBuilding í•¨ìˆ˜ëŠ”
            // * ì›ë³¸ ì½”ë“œì—ì„œ UI/ë¡œì§ ë¶„ë¦¬ê°€ í•„ìš” ì—†ëŠ” ë¶€ë¶„ì´ë¯€ë¡œ ë‚´ìš© ë³€í™” ì—†ì´ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

            // ---------------------------------------------------------
            // ğŸš¨ ë¬´ì¥ì•  ì‹œì„¤ ë²„íŠ¼ í´ë¦­ ë¦¬ìŠ¤ë„ˆ (ë¡œì§ ë¶„ë¦¬)
            // ---------------------------------------------------------
            accessBtn.addEventListener('click', function() {
                if (!currentBuildingId) {
                    [cite_start]coordDisplay.textContent = 'ë¬´ì¥ì•  ì‹œì„¤ ì •ë³´ëŠ” ê±´ë¬¼ì„ í´ë¦­í•˜ì—¬ ì‹¤ë‚´ ëª¨ë“œ ì§„ì… í›„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.'; [cite: 198]
                    [cite_start]return; [cite: 199]
                }

                const isOpen = popup.style.display === 'block';
                
                if (!isOpen) {
                    const buttonRect = accessBtn.getBoundingClientRect();
                    
                    // ğŸš¨ ëª¨ë°”ì¼ ë° ë°ìŠ¤í¬í†± ìœ„ì¹˜ ê³„ì‚° ë¶„ê¸°
                    if (isMobile()) {
                        // ëª¨ë°”ì¼: ë²„íŠ¼ ì˜†ì— í‘œì‹œ, í•˜ë‹¨ 20px ê³ ì •
                        [cite_start]const newPopupLeft = buttonRect.right + 5; [cite: 201]
                        [cite_start]popup.style.bottom = '20px'; [cite: 201]
                        popup.style.left = newPopupLeft + 'px'; 
                        popup.style.top = 'auto'; // top ì´ˆê¸°í™”
                        popup.style.right = 'auto'; // right ì´ˆê¸°í™”
                        
                    } else {
                        // ë°ìŠ¤í¬í†±: ìš°ì¸¡ í•˜ë‹¨ì—ì„œ ë²„íŠ¼ê³¼ ê°™ì€ ë†’ì´ì— í‘œì‹œ
                        popup.style.bottom = '80px'; // floorControlsì˜ bottom ìœ„ì¹˜ì— ë§ì¶¤
                        popup.style.top = 'auto'; // top ì´ˆê¸°í™”
                        popup.style.left = 'auto'; // left ì´ˆê¸°í™”
                        
                    }
                    
                    // íŒì—… ì—´ê¸°
                    [cite_start]popup.style.display = 'block'; [cite: 203]
                    [cite_start]this.classList.add('active'); [cite: 203]
                } else {
                    // íŒì—… ë‹«ê¸°
                    [cite_start]popup.style.display = 'none'; [cite: 204]
                    [cite_start]this.classList.remove('active'); [cite: 205]
                }
            });

            // * geolocationBtn í´ë¦­ ë¦¬ìŠ¤ë„ˆ ë° ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” ë³€í™” ì—†ìŒ (ìƒëµ)
            
            // ëª¨ë“  ê±´ë¬¼ ì„¤ì •
            for (const id in buildings) {
                [cite_start]setupBuilding(id, buildings[id]); [cite: 196]
            }

            [cite_start]// ì§€ë„ í´ë¦­ ë¦¬ìŠ¤ë„ˆ (ê¸°ë³¸ ë¬¸êµ¬ ìœ ì§€) [cite: 196]
            naver.maps.Event.addListener(map, 'click', function (e) {
                if (!groundOverlay || groundOverlay.getMap() === null) {
                    [cite_start]coordDisplay.textContent = 'ê±´ë¬¼ì„ í´ë¦­í•˜ë©´ ì‹¤ë‚´ì§€ë„ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”'; [cite: 197]
                }
            });
            
            // ë¬´ì¥ì•  ì‹œì„¤ì •ë³´ íŒì—… ë‹«ê¸° ì´ë²¤íŠ¸ (X ë²„íŠ¼ í´ë¦­)
            if (popupClose) {
                popupClose.onclick = function() {
                    [cite_start]popup.style.display = 'none'; [cite: 206]
                    [cite_start]accessBtn.classList.remove('active'); [cite: 207]
                };
            }
            
            // --- ë‚˜ë¨¸ì§€ í•¨ìˆ˜ë“¤ (showFloor, renderFloorButtons, updateAccessPopup, setupBuilding)ì˜ ì›ë³¸ ì½”ë“œ ë‚´ìš©ì€ ì—¬ê¸°ì— ê·¸ëŒ€ë¡œ ì‚½ì…ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ---
            // (ì½”ë“œ ê¸¸ì´ ì œí•œìœ¼ë¡œ ì¸í•´ ëª¨ë“  í•¨ìˆ˜ë¥¼ ì—¬ê¸°ì— í‘œì‹œí•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.)
        }; [cite_start]// script.onload ì¢…ë£Œ [cite: 208]

        // API ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€
        script.onerror = function () {
            [cite_start]console.error('ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ ì‹¤íŒ¨! URL ë˜ëŠ” Keyë¥¼ í™•ì¸í•˜ì„¸ìš”.'); [cite: 209]
        };

        document.head.appendChild(script);
        
    </script>
</body>
</html>
