<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë„¤ì´ë²„ ë²¡í„°ë§µ í…ŒìŠ¤íŠ¸ - ë‹¤ì¤‘ ê±´ë¬¼ ì§€ì›</title>
    <style>
        body { margin: 0;
padding: 0; height: 100vh; font-family: 'Malgun Gothic', sans-serif; }
        #map { width: 100%;
height: 100%; }
        #status {
            position: absolute;
top: 10px; left: 10px;
            background: rgba(255, 99, 71, 0.9);
            color: white; padding: 10px 15px;
            border-radius: 5px; font-size: 14px;
            z-index: 1000;
box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #coordDisplay {
            position: absolute;
top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.75);
            color: #FFC107;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            z-index: 1500;
box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            min-width: 200px;
        }

        /* ê³µí†µ ì›í˜• ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .map-btn-circle {
            width: 45px;
            height: 45px;
            padding: 0;
            cursor: pointer;
            background: #ffffff;
            border: none; /* í…Œë‘ë¦¬ ì œê±° */
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            color: #000;
            font-weight: normal;
            font-size: 14px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            line-height: 1;
        }

        /* í˜„ì¬ ìœ„ì¹˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #geolocationBtn {
            position: absolute;
            bottom: 20px; /* í•˜ë‹¨ ì™¼ìª½ ì½”ë„ˆ */
            left: 10px;
            z-index: 1500;
            font-size: 18px; /* ğŸ“ ì•„ì´ì½˜ í¬ê¸° */
        }
        
        /* ì¸µ ì»¨íŠ¸ë¡¤ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        #floorControls {
            position: absolute;
            bottom: 75px; /* GeolocationBtn (45px) + gap (10px) + bottom (20px) = 75px */
            left: 10px;
            display: none;
            flex-direction: column-reverse; /* ë²„íŠ¼ì„ ì•„ë˜ì—ì„œ ìœ„ë¡œ ìŒ“ê¸° ìœ„í•´ */
            gap: 10px; /* ë²„íŠ¼ ì‚¬ì´ ê°„ê²© */
            z-index: 1500;
            background: transparent;
            padding: 0;
            box-shadow: none;
        }

        /* ì¸µ ë²„íŠ¼/ì•¡ì„¸ìŠ¤ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ê³µí†µ ì›í˜• ìŠ¤íƒ€ì¼ ìƒì†) */
        .floor-btn {
            font-size: 14px;
        }

        /* í´ë¦­ëœ ë²„íŠ¼ í™œì„± ìŠ¤íƒ€ì¼ */
        .map-btn-circle.active {
            background: #007bff;
            color: #fff;
            font-weight: bold;
        }
        
        /* ë¬´ì¥ì•  íŒì—… */
        #accessPopup {
            position: absolute;
            bottom: 300px; /* ë²„íŠ¼ ìŠ¤íƒ ìœ„ì— ì•ˆì „í•˜ê²Œ ë°°ì¹˜ */
            left: 10px;
            width: 260px;
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
            display: none;
            z-index: 2000;
        }
    </style>
</head>
<body>
    <div id="status">API í‚¤ í™•ì¸ ì¤‘...</div>
    <div id="coordDisplay">ê±´ë¬¼ì„ í´ë¦­í•˜ë©´ ì‹¤ë‚´ì§€ë„ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”</div>
    
    <button id="geolocationBtn" class="map-btn-circle" title="í˜„ì¬ ìœ„ì¹˜ ì°¾ê¸°">ğŸ“</button>
    
    <div id="floorControls">
        <button id="accessInfoBtn" class="floor-btn map-btn-circle" data-floor="access">i</button>
        </div>

    <div id="accessPopup" style="display:none;">
 
        <span id="accessPopupClose" style="position:absolute; top:8px; right:12px; font-size:22px; cursor:pointer; color:#777;">Ã—</span>
        <div style="font-size:1.2rem; font-weight:700; margin-bottom:15px; color:#1e3a8a;">ë¬´ì¥ì•  ì‹œì„¤ ì •ë³´</div>
        <div style="display:flex; margin-bottom:8px;"><span>â€¢ ì£¼ì¶œì…êµ¬ ê²½ì‚¬ë¡œ</span><span style="margin-left:auto; font-weight:600; color:#10b981;">ìˆìŒ</span></div>
        <div style="display:flex;
margin-bottom:8px;"><span>â€¢ ì¥ì• ì¸ í™”ì¥ì‹¤</span><span style="margin-left:auto; font-weight:600; color:#10b981;">ìˆìŒ</span></div>
        <div style="display:flex; margin-bottom:8px;"><span>â€¢ ì ìë¸”ë¡</span><span style="margin-left:auto; font-weight:600;
color:#10b981;">ìˆìŒ</span></div>
        <div style="display:flex; margin-bottom:8px;"><span>â€¢ ì—˜ë¦¬ë² ì´í„°</span><span style="margin-left:auto; font-weight:600;
color:#10b981;">ìˆìŒ</span></div>
        <div style="display:flex; margin-bottom:8px;"><span>â€¢ ì£¼ì¶œì…êµ¬ ë‹¨ì°¨</span><span style="margin-left:auto; font-weight:600;
color:#ef4444;">ìˆìŒ</span></div>
    </div>

    <div id="map"></div>

    <script>
        const NCP_KEY_ID = 'q1d23mmkof';
        const script = document.createElement('script');
        script.src = `https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=${NCP_KEY_ID}&vmode=3`;

        script.onload = function () {
            document.getElementById('status').textContent = 'API ë¡œë“œ ì„±ê³µ!';
            document.getElementById('status').style.background = 'rgba(60, 179, 113, 0.9)';
            
            // ì „ì—­ DOM ìš”ì†Œ ë³€ìˆ˜
            const coordDisplay = document.getElementById('coordDisplay');
            const floorControlsContainer = document.getElementById('floorControls');
            const popup = document.getElementById('accessPopup');
            const accessBtn = document.getElementById('accessInfoBtn');
            const popupClose = document.getElementById('accessPopupClose');
            const geolocationBtn = document.getElementById('geolocationBtn');

            // ì§€ë„ì˜ ì¤‘ì‹¬ ì¢Œí‘œë¥¼ ë‘ ê±´ë¬¼ì„ ëª¨ë‘ ë³¼ ìˆ˜ ìˆë„ë¡ ì¡°ì •
            const mapOptions = {
                center: new naver.maps.LatLng(37.5710, 126.9784),
                zoom: 17, // ì¤Œ ë ˆë²¨ ì¡°ì •
                zoomControl: false, // í™•ëŒ€/ì¶•ì†Œ ì»¨íŠ¸ë¡¤ ì œê±°
                mapTypes: new naver.maps.MapTypeRegistry({
                    normal: naver.maps.NaverStyleMapTypeOptions.getVectorMap(),
                }),
            };
            const map = new naver.maps.Map('map', mapOptions);
            map.setMapTypeId('normal');
            const labelLayer = new naver.maps.LabelLayer();
            labelLayer.setMap(map);
            document.getElementById('status').style.display = 'none';

            let groundOverlay = null; // í˜„ì¬ í™œì„±í™”ëœ GroundOverlay
            let currentBuildingId = null; // í˜„ì¬ í™œì„±í™”ëœ ê±´ë¬¼ ID
            let currentPositionMarker = null; // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ì €ì¥ ë³€ìˆ˜

            // =========================================================
            // ë¹Œë”©ë³„ ë°ì´í„° ì •ì˜
            // =========================================================
            const buildings = {
                'ky': { // ê±´ë¬¼ 1: ê¸°ì¡´ ê±´ë¬¼ (ky1.jpg, 8ê°í˜• ì™¸ê³½ì„ )
                    polygonCoords: [
                        new naver.maps.LatLng(37.571350, 126.977670),
                        new naver.maps.LatLng(37.571360, 126.978059),
                        new naver.maps.LatLng(37.571275, 126.978063),
                        new naver.maps.LatLng(37.571275, 126.978173),
                        new naver.maps.LatLng(37.570870, 126.978184),
                        new naver.maps.LatLng(37.570872, 126.978082),
                        new naver.maps.LatLng(37.570543, 126.978094),
                        new naver.maps.LatLng(37.570539, 126.977702),
                    ],
                    floors: ['b1', '1f', '2f'],
                    images: {
                        'b1': 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/ky_1.jpg',
                        '1f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/ky1.jpg', // ë³€ê²½ëœ íŒŒì¼ëª…
                        '2f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/ky_1.jpg',
                    },
                    imageBounds: new naver.maps.LatLngBounds(
                        new naver.maps.LatLng(37.570512, 126.977632), // SW (ë³€ê²½ë¨)
                        new naver.maps.LatLng(37.571415, 126.978244)  // NE (ë³€ê²½ë¨)
                    ),
                    currentFloor: '1f', // í˜„ì¬ í™œì„±í™”ëœ ì¸µ
                    polygon: null,
                },
                'dt': { // ê±´ë¬¼ 2: ìƒˆë¡œ ì¶”ê°€ëœ ê±´ë¬¼
                    polygonCoords: [
                        new naver.maps.LatLng(37.571470, 126.978762),
                        new naver.maps.LatLng(37.571476, 126.979161),
                        new naver.maps.LatLng(37.570627, 126.979181),
                        new naver.maps.LatLng(37.570557, 126.979117),
                        new naver.maps.LatLng(37.570553, 126.978777),
                    ],
                    floors: ['b4', '1f'], // B4, 1F ì¸µ ë²„íŠ¼
                    images: {
                        'b4': 'https://raw.githubusercontent.com/candream99/disabledmap/main/dt/dt_b4.png',
                        '1f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/dt/dt1.png',
                    },
                    imageBounds: new naver.maps.LatLngBounds(
                        new naver.maps.LatLng(37.570459, 126.978649), // SW (ìƒˆ ì¢Œí‘œ)
                        new naver.maps.LatLng(37.571626, 126.979210)  // NE (ìƒˆ ì¢Œí‘œ)
                    ),
                    currentFloor: '1f',
                    polygon: null,
                }
            };

            // =========================================================
            // í•µì‹¬ ë¡œì§ í•¨ìˆ˜
            // =========================================================

            // Access íŒì—…ì´ ë‹«í ë•Œ ë§ˆì§€ë§‰ í™œì„±í™”ëœ ì¸µ ë²„íŠ¼ì„ ë‹¤ì‹œ í™œì„±í™”
            function updateFloorButtonState() {
                // ëª¨ë“  ì¸µ ë²„íŠ¼ì˜ active ìƒíƒœ ì œê±°
                document.querySelectorAll('#floorControls .floor-btn').forEach(b => b.classList.remove('active'));

                if (currentBuildingId) {
                    const config = buildings[currentBuildingId];
                    const floorBtn = document.querySelector(`#floorControls .floor-btn[data-floor="${config.currentFloor}"]`);
                    if (floorBtn) {
                        floorBtn.classList.add('active');
                    }
                }
            }

            // ì¸µ ì§€ë„(GroundOverlay) í‘œì‹œ
            function showFloor(buildingId, floor) {
                const config = buildings[buildingId];
                if (!config || !config.images[floor]) return;

                currentBuildingId = buildingId;
                config.currentFloor = floor; // í˜„ì¬ ì¸µ ìƒíƒœ ì—…ë°ì´íŠ¸
                
                if (groundOverlay) groundOverlay.setMap(null);

                // ë‹¤ë¥¸ ê±´ë¬¼ í´ë¦¬ê³¤ ìˆ¨ê¸°ê¸°
                for (const id in buildings) {
                    if (id !== buildingId && buildings[id].polygon) {
                        buildings[id].polygon.setMap(null); // ë‹¤ë¥¸ ê±´ë¬¼ í´ë¦¬ê³¤ ìˆ¨ê¸°ê¸°
                    }
                }

                // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ê°€ ìˆë‹¤ë©´ ì œê±° (ì‹¤ë‚´ ëª¨ë“œ ì§„ì… ì‹œ)
                if (currentPositionMarker) {
                    currentPositionMarker.setMap(null);
                }

                groundOverlay = new naver.maps.GroundOverlay(
                    config.images[floor],
                    config.imageBounds,
                    {
                        map: map,
                        clickable: true,
                        opacity: 1,
                    }
                );

                // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸: ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™” í›„ ì„ íƒëœ ë²„íŠ¼ í™œì„±í™”
                document.querySelectorAll('#floorControls .floor-btn').forEach(btn => btn.classList.remove('active'));
                accessBtn.classList.remove('active'); // i ë²„íŠ¼ë„ ì´ˆê¸°í™”
                
                const floorBtn = document.querySelector(`#floorControls .floor-btn[data-floor="${floor}"]`);
                if (floorBtn) floorBtn.classList.add('active');

                // ì‹¤ë‚´ ëª¨ë“œ ì¢…ë£Œ ë¦¬ìŠ¤ë„ˆ (GroundOverlay í´ë¦­ ì‹œ)
                naver.maps.Event.addListener(groundOverlay, 'click', function (e) {
                    e.stopOverlays = true;
                    groundOverlay.setMap(null);
                    
                    // íŒì—…ì°½ ë‹«ê¸° ë° ë²„íŠ¼ active í•´ì œ
                    popup.style.display = 'none';
                    accessBtn.classList.remove('active');
                    
                    // ëª¨ë“  ê±´ë¬¼ í´ë¦¬ê³¤ ë³µì›
                    for (const id in buildings) {
                        if (buildings[id].polygon) {
                            buildings[id].polygon.setMap(map); 
                            buildings[id].polygon.setOptions({ fillColor: 'transparent' }); 
                        }
                    }

                    floorControlsContainer.style.display = 'none'; // ì»¨íŠ¸ë¡¤ ìˆ¨ê¸°ê¸°
                    config.polygon.setOptions({ fillColor: 'transparent' }); // í˜„ì¬ ê±´ë¬¼ì˜ ì™¸ê³½ì„  ìƒ‰ìƒ ë³µì›
                    labelLayer.setMap(map);
                    currentBuildingId = null; // ê±´ë¬¼ ìƒíƒœ ì´ˆê¸°í™”

                    // ì‹¤ë‚´ ëª¨ë“œ ì¢…ë£Œ ë¬¸êµ¬
                    coordDisplay.textContent = 'ê±´ë¬¼ì„ í´ë¦­í•˜ë©´ ì‹¤ë‚´ì§€ë„ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”'; 
                });
            }

            // ì¸µ ë²„íŠ¼ ë™ì  ìƒì„± ë° ë Œë”ë§
            function renderFloorButtons(buildingId) {
                const config = buildings[buildingId];
                
                // ê¸°ì¡´ ì¸µ ë²„íŠ¼ë§Œ ì œê±° (i ë²„íŠ¼ ì œì™¸)
                document.querySelectorAll('#floorControls .floor-btn:not(#accessInfoBtn)').forEach(btn => btn.remove());
                
                const defaultFloor = config.floors.includes('1f') ? '1f' : config.floors[0];
                config.currentFloor = defaultFloor;

                // ìƒˆë¡œìš´ ì¸µ ë²„íŠ¼ ìƒì„± ë° ì¶”ê°€
                config.floors.forEach(floor => {
                    const btn = document.createElement('button');
                    btn.className = 'floor-btn map-btn-circle'; // ìƒˆ ìŠ¤íƒ€ì¼ ì ìš©
                    btn.dataset.floor = floor;
                    btn.textContent = floor.toUpperCase();
                    
                    // 'i' ë²„íŠ¼ ë°”ë¡œ ìœ„ì— ì˜¤ë„ë¡ prepend
                    floorControlsContainer.prepend(btn);

                    if (floor === defaultFloor) {
                        btn.classList.add('active');
                    }

                    btn.addEventListener('click', () => {
                        // Access íŒì—… ë‹«ê¸° ë° ë²„íŠ¼ active í•´ì œ
                        popup.style.display = 'none';
                        accessBtn.classList.remove('active');
                        showFloor(buildingId, floor);
                    });
                });
            }

            // ê±´ë¬¼ë³„ Polygon ìƒì„± ë° ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            function setupBuilding(buildingId, config) {
                const polygon = new naver.maps.Polygon({
                    map: map,
                    paths: [config.polygonCoords],
                    fillColor: 'transparent',
                    fillOpacity: 0.5,
                    strokeColor: '#C490E4',
                    strokeOpacity: 1,
                    strokeWeight: 3,
                    clickable: true,
                });
                config.polygon = polygon; // Polygon ê°ì²´ë¥¼ configì— ì €ì¥

                // ë§ˆìš°ìŠ¤ ì˜¤ë²„ ë¦¬ìŠ¤ë„ˆ 
                naver.maps.Event.addListener(polygon, 'mouseover', function() {
                    if (!groundOverlay || groundOverlay.getMap() === null) {
                        polygon.setOptions({ fillColor: '#C490E4' });
                        coordDisplay.textContent = 'í´ë¦­í•´ì„œ ì‹¤ë‚´ì§€ë„ë¥¼ ë³´ì„¸ìš”';
                    }
                });

                // ë§ˆìš°ìŠ¤ ì•„ì›ƒ ë¦¬ìŠ¤ë„ˆ 
                naver.maps.Event.addListener(polygon, 'mouseout', function() {
                    if (!groundOverlay || groundOverlay.getMap() === null) {
                        polygon.setOptions({ fillColor: 'transparent' });
                        coordDisplay.textContent = 'ê±´ë¬¼ì„ í´ë¦­í•˜ë©´ ì‹¤ë‚´ì§€ë„ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”';
                    }
                });

                // í´ë¦­ ë¦¬ìŠ¤ë„ˆ (ì‹¤ë‚´ ëª¨ë“œ ì§„ì…)
                naver.maps.Event.addListener(polygon, 'click', function (e) {
                    e.stopOverlays = true;
                    labelLayer.setMap(null);
                    polygon.setOptions({ fillColor: '#C490E4' });
                    floorControlsContainer.style.display = 'flex'; // ì»¨íŠ¸ë¡¤ ë³´ì´ê¸°
                    
                    // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ê°€ ìˆë‹¤ë©´ ì œê±°
                    if (currentPositionMarker) {
                        currentPositionMarker.setMap(null);
                    }

                    // í•´ë‹¹ ê±´ë¬¼ì˜ ì¸µ ë²„íŠ¼ ë Œë”ë§
                    renderFloorButtons(buildingId);
                    
                    // ê¸°ë³¸ ì¸µ(1F ë˜ëŠ” ì²« ì¸µ) í‘œì‹œ
                    const defaultFloor = config.floors.includes('1f') ? '1f' : config.floors[0];
                    showFloor(buildingId, defaultFloor);

                    // ì‹¤ë‚´ ëª¨ë“œ ì§„ì… ë¬¸êµ¬
                    coordDisplay.textContent = 'ì¼ë°˜ì§€ë„ë¡œ ëŒì•„ê°€ë ¤ë©´ ì‹¤ë‚´ì§€ë„ë¥¼ í´ë¦­í•˜ì„¸ìš”'; 
                });
            }

            // =========================================================
            // í˜„ì¬ ìœ„ì¹˜ (Geolocation) ê¸°ëŠ¥
            // =========================================================
            geolocationBtn.addEventListener('click', function() {
                // ì‹¤ë‚´ ëª¨ë“œì¼ ê²½ìš° ê²½ê³ 
                if (currentBuildingId !== null) {
                    alert('ì‹¤ë‚´ ëª¨ë“œë¥¼ ë¨¼ì € ì¢…ë£Œí•˜ê³  í˜„ì¬ ìœ„ì¹˜ë¥¼ ì°¾ì•„ì£¼ì„¸ìš”.');
                    return;
                }
                
                // ë²„íŠ¼ active ìƒíƒœ í† ê¸€
                geolocationBtn.classList.toggle('active');

                if (navigator.geolocation) {
                    coordDisplay.textContent = 'í˜„ì¬ ìœ„ì¹˜ë¥¼ ì°¾ëŠ” ì¤‘ì…ë‹ˆë‹¤...';
                    
                    navigator.geolocation.getCurrentPosition(
                        function(position) {
                            const lat = position.coords.latitude;
                            const lng = position.coords.longitude;
                            const currentLatLng = new naver.maps.LatLng(lat, lng);

                            map.setCenter(currentLatLng);
                            map.setZoom(17); 

                            // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
                            if (currentPositionMarker) {
                                currentPositionMarker.setMap(null);
                            }

                            // ìƒˆë¡œìš´ í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ìƒì„± (íŒŒë€ìƒ‰ ë„íŠ¸)
                            currentPositionMarker = new naver.maps.Marker({
                                map: map,
                                position: currentLatLng,
                                icon: {
                                    content: '<div style="width:12px; height:12px; background-color:#007bff; border-radius:50%; border:2px solid #ffffff; box-shadow:0 0 5px rgba(0,0,0,0.5);"></div>',
                                    size: new naver.maps.Size(12, 12),
                                    anchor: new naver.maps.Point(6, 6)
                                },
                                zIndex: 9999
                            });
                            
                            coordDisplay.textContent = 'í˜„ì¬ ìœ„ì¹˜ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤! ê±´ë¬¼ì„ í´ë¦­í•˜ë©´ ì‹¤ë‚´ì§€ë„ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”';
                            geolocationBtn.classList.add('active'); // ì„±ê³µ ì‹œ active ìœ ì§€

                        },
                        function(error) {
                            console.error("Geolocation Error:", error);
                            alert('ìœ„ì¹˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                            coordDisplay.textContent = 'ìœ„ì¹˜ ì°¾ê¸° ì‹¤íŒ¨: ê±´ë¬¼ì„ í´ë¦­í•˜ë©´ ì‹¤ë‚´ì§€ë„ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”';
                            
                            if (currentPositionMarker) {
                                currentPositionMarker.setMap(null);
                            }
                            geolocationBtn.classList.remove('active'); // ì‹¤íŒ¨ ì‹œ active í•´ì œ
                        },
                        { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 } 
                    );
                } else {
                    alert('ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” Geolocationì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    coordDisplay.textContent = 'Geolocation ë¯¸ì§€ì›: ê±´ë¬¼ì„ í´ë¦­í•˜ë©´ ì‹¤ë‚´ì§€ë„ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”';
                    geolocationBtn.classList.remove('active'); // ë¯¸ì§€ì› ì‹œ active í•´ì œ
                }
            });


            // =========================================================
            // ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            // =========================================================

            // ëª¨ë“  ê±´ë¬¼ ì„¤ì •
            for (const id in buildings) {
                setupBuilding(id, buildings[id]);
            }

            // ì§€ë„ í´ë¦­ ë¦¬ìŠ¤ë„ˆ (ê¸°ë³¸ ë¬¸êµ¬ ìœ ì§€)
            naver.maps.Event.addListener(map, 'click', function (e) {
                if (!groundOverlay || groundOverlay.getMap() === null) {
                    coordDisplay.textContent = 'ê±´ë¬¼ì„ í´ë¦­í•˜ë©´ ì‹¤ë‚´ì§€ë„ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”';
                }
            });
            
            // ë¬´ì¥ì• ì‹œì„¤ ë²„íŠ¼ ('i' ë²„íŠ¼) í´ë¦­ ë¦¬ìŠ¤ë„ˆ
            accessBtn.addEventListener('click', function() {
                const isOpen = popup.style.display === 'block';
                
                // ì¸µ ë²„íŠ¼ì˜ active ìƒíƒœë¥¼ ëª¨ë‘ í•´ì œ (i ë²„íŠ¼ í´ë¦­ ì‹œ)
                document.querySelectorAll('#floorControls .floor-btn').forEach(b => b.classList.remove('active'));

                if (!isOpen) {
                    // íŒì—… ì—´ê¸°
                    popup.style.display = 'block';
                    this.classList.add('active');
                } else {
                    // íŒì—… ë‹«ê¸°
                    popup.style.display = 'none';
                    this.classList.remove('active');
                    updateFloorButtonState(); // íŒì—… ë‹«ê³  ì›ë˜ ì¸µ ë²„íŠ¼ active ë³µì›
                }
            });

            // ë¬´ì¥ì•  ì‹œì„¤ì •ë³´ íŒì—… ë‹«ê¸° ì´ë²¤íŠ¸ (X ë²„íŠ¼ í´ë¦­)
            if (popupClose) {
                popupClose.onclick = () => {
                    popup.style.display = 'none';
                    accessBtn.classList.remove('active');
                    updateFloorButtonState(); // ë§ˆì§€ë§‰ í™œì„±í™” ì¸µ ë²„íŠ¼ ë³µì›
                };
            }
        };

        // API ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€
        script.onerror = function () {
            document.getElementById('status').textContent = 'API ë¡œë“œ ì‹¤íŒ¨! URL ë˜ëŠ” Key í™•ì¸!';
            document.getElementById('status').style.background = 'red';
        };

        document.head.appendChild(script);
        
    </script>
</body>
</html>
