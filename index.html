<!DOCTYPE html>
<html>
<head>
    <title>네이버 지도 기반 광화문 교보빌딩 실내 지도</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <meta charset="utf-8">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Malgun Gothic', sans-serif;
        }
        #map {
            height: 100%;
        }
        #floor-picker {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 999;
            display: none;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .floor-button {
            padding: 10px 15px;
            margin: 5px 0;
            background: #f7f7f7;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        .floor-button.active {
            background: #4A90E2;
            color: white;
        }
        #coord-guide {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f44336;
            padding: 10px;
            color: white;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            z-index: 999;
        }
    </style>
</head>
<body>

<div id="map"></div>
<div id="floor-picker"></div>
<div id="coord-guide"><i class="fas fa-crosshairs"></i> 좌표 추출 모드 활성화됨</div>

<script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=q1d23mmkof"></script>

<script>
/* ===============================
    좌표 및 건물 설정
================================ */
const COORDS = {
    NW: { lat: 37.571346, lng: 126.977674 },
    NE: { lat: 37.571349, lng: 126.978057 },
    SE: { lat: 37.570542, lng: 126.978087 },
    SW: { lat: 37.570541, lng: 126.977699 }
};

const centerLat = (COORDS.NW.lat + COORDS.SE.lat) / 2;
const centerLng = (COORDS.NW.lng + COORDS.SE.lng) / 2;

const BUILDING_CONFIGS = {
    kyobo: {
        center: new naver.maps.LatLng(centerLat, centerLng),
        polygonPaths: [
            [
                new naver.maps.LatLng(COORDS.NW.lat, COORDS.NW.lng),
                new naver.maps.LatLng(COORDS.NE.lat, COORDS.NE.lng),
                new naver.maps.LatLng(COORDS.SE.lat, COORDS.SE.lng),
                new naver.maps.LatLng(COORDS.SW.lat, COORDS.SW.lng)
            ]
        ],
        floors: {
            B1: {
                label: "지하 1층",
                imageUrl: "https://placehold.co/1000x800/2962FF/FFFFFF?text=KYOBODB+B1",
                imageBounds: new naver.maps.LatLngBounds(
                    new naver.maps.LatLng(COORDS.NW.lat, COORDS.NW.lng),
                    new naver.maps.LatLng(COORDS.SE.lat, COORDS.SE.lng)
                )
            },
            "1F": {
                label: "1층",
                imageUrl: "https://placehold.co/1000x800/1DE9B6/333333?text=KYOBODB+1F",
                imageBounds: new naver.maps.LatLngBounds(
                    new naver.maps.LatLng(COORDS.NW.lat, COORDS.NW.lng),
                    new naver.maps.LatLng(COORDS.SE.lat, COORDS.SE.lng)
                )
            },
            "2F": {
                label: "2층",
                imageUrl: "https://placehold.co/1000x800/FFEA00/333333?text=KYOBODB+2F",
                imageBounds: new naver.maps.LatLngBounds(
                    new naver.maps.LatLng(COORDS.NW.lat, COORDS.NW.lng),
                    new naver.maps.LatLng(COORDS.SE.lat, COORDS.SE.lng)
                )
            }
        }
    }
};

/* ===============================
    전역 변수
================================ */
let mapInstance;
let isIndoor = false;
let activeBuilding = null;
let clickListener = null;
let currentFloor = null;

const buildingPolygons = {};
const floorOverlays = {};

/* ===============================
    좌표 추출 기능
================================ */
function enableCoordExtract() {
    document.getElementById("coord-guide").style.display = "block";

    clickListener = naver.maps.Event.addListener(mapInstance, "click", (e) => {
        alert(`위도: ${e.coord.y.toFixed(6)}\n경도: ${e.coord.x.toFixed(6)}`);
    });
}

function disableCoordExtract() {
    if (clickListener) naver.maps.Event.removeListener(clickListener);
    document.getElementById("coord-guide").style.display = "none";
}

/* ===============================
    층 오버레이
================================ */
function setFloor(floorId) {
    const key = `${activeBuilding}_${floorId}`;

    if (currentFloor) {
        const oldKey = `${activeBuilding}_${currentFloor}`;
        floorOverlays[oldKey].setMap(null);
    }

    floorOverlays[key].setMap(mapInstance);
    currentFloor = floorId;

    document.querySelectorAll(".floor-button").forEach(btn =>
        btn.classList.toggle("active", btn.dataset.floorId === floorId)
    );
}

/* ===============================
    실내 모드 ON
================================ */
function enterIndoor(buildingId) {
    disableCoordExtract();
    isIndoor = true;
    activeBuilding = buildingId;

    mapInstance.setZoom(20);
    mapInstance.setCenter(BUILDING_CONFIGS[buildingId].center);

    // ★ 라벨 제거
    mapInstance.setOptions({ label: false });

    const picker = document.getElementById("floor-picker");
    picker.innerHTML = "";
    picker.style.display = "block";

    const floors = Object.keys(BUILDING_CONFIGS[buildingId].floors).reverse();
    floors.forEach(floorId => {
        const btn = document.createElement("div");
        btn.className = "floor-button";
        btn.innerText = BUILDING_CONFIGS[buildingId].floors[floorId].label;
        btn.dataset.floorId = floorId;
        btn.addEventListener("click", () => setFloor(floorId));
        picker.appendChild(btn);
    });

    setFloor(floors[0]);
}

/* ===============================
    실내 모드 OFF
================================ */
function exitIndoor() {
    isIndoor = false;

    // 층 오버레이 제거
    if (currentFloor) {
        const key = `${activeBuilding}_${currentFloor}`;
        floorOverlays[key].setMap(null);
    }

    currentFloor = null;
    activeBuilding = null;

    document.getElementById("floor-picker").style.display = "none";

    // ★ 라벨 복귀
    mapInstance.setOptions({ label: true });

    mapInstance.setZoom(19);

    enableCoordExtract();
}

/* ===============================
    지도 초기화
================================ */
function initMap() {

    mapInstance = new naver.maps.Map("map", {
        center: BUILDING_CONFIGS.kyobo.center,
        zoom: 19,
        mapTypeId: naver.maps.MapTypeId.NORMAL
    });

    enableCoordExtract();

    /* 건물 폴리곤 */
    Object.keys(BUILDING_CONFIGS).forEach(id => {
        const cfg = BUILDING_CONFIGS[id];

        const polygon = new naver.maps.Polygon({
            map: mapInstance,
            paths: cfg.polygonPaths,
            fillColor: "#FFC107",
            fillOpacity: 0.15,
            strokeColor: "#FFC107",
            strokeWeight: 2,
            clickable: true
        });

        buildingPolygons[id] = polygon;

        naver.maps.Event.addListener(polygon, "click", () => {
            if (!isIndoor) enterIndoor(id);
            else exitIndoor();
        });

        /* 층 오버레이 생성 */
        Object.keys(cfg.floors).forEach(floorId => {
            const f = cfg.floors[floorId];
            floorOverlays[`${id}_${floorId}`] =
                new naver.maps.GroundOverlay(f.imageUrl, f.imageBounds, { opacity: 0.85 });
        });
    });
}

naver.maps.onJSContentLoaded = initMap;

</script>

</body>
</html>
