<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë°ìŠ¤í¬íƒ‘ ì „ìš© ì§€ë„</title>
    <style>
        /* ì „ì²´ ë° ë ˆì´ì•„ì›ƒ */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Malgun Gothic', sans-serif;
            overflow: hidden;
        }
        #container {
            display: flex; /* ê°€ë¡œ ë°°ì—´ ìœ ì§€ */
            width: 100vw;
            height: 100vh;
        }

        /* [ì¶”ê°€] ìµœì¢Œì¸¡ ì–‡ì€ íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        #gnb {
            width: 64px;
            height: 100%;
            background-color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-shrink: 0;
            z-index: 1100;
        }
        .gnb-logo {
            padding: 20px 0;
            width: 100%;
            display: flex;
            justify-content: center;
        }
        .gnb-logo img {
            width: 40px;
            height: auto;
        }
        .gnb-menu {
            display: flex;
            flex-direction: column;
            width: 100%;
            margin-top: 10px;
        }
        .gnb-btn {
            background: none;
            border: none;
            padding: 15px 0;
            color: #999;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 18px;
            transition: background 0.2s;
        }
        .gnb-btn:hover { background-color: #444; }
        .gnb-btn.active { color: #fff; background-color: #444; }
        .btn-text { font-size: 10px; margin-top: 4px; }

        /* ì™¼ìª½ ì‚¬ì´ë“œë°”: ê¸°ì¡´ ë””ìì¸ ìœ ì§€ */
        #sidebar {
            width: 20%;
            min-width: 260px;
            max-width: 420px;
            height: 100%;
            box-sizing: border-box;
            background: #fafafa;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            z-index: 1000;
            overflow: hidden;
        }

        /* ê²€ìƒ‰ì˜ì—­ */
        #searchArea {
            padding: 14px;
            border-bottom: 1px solid #eee;
            background: #fff;
        }
        #searchInput {
            width: 100%;
            height: 42px;
            padding: 0 12px;
            border-radius: 8px;
            border: 1px solid #d1d5db;
            font-size: 15px;
            box-sizing: border-box;
        }

        #buildingList {
            padding: 10px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            flex: 1 1 auto;
        }

        .building-card {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            padding: 10px;
            border-radius: 8px;
            background: white;
            margin-bottom: 10px;
            cursor: pointer;
            border: 1px solid #f0f0f0;
            transition: box-shadow .12s, transform .08s;
        }
        .building-card:hover {
            box-shadow: 0 6px 18px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }
        .building-thumb {
            width: 72px;
            height: 72px;
            object-fit: cover;
            border-radius: 6px;
            flex-shrink: 0;
            background: #f3f4f6;
        }
        .building-info {
            flex: 1 1 auto;
        }
        .building-name {
            font-weight: 700;
            font-size: 15px;
            margin-bottom: 6px;
            color: #111827;
        }
        .building-meta {
            font-size: 13px;
            color: #6b7280;
            line-height: 1.25;
        }

        /* ì‹¤ë‚´ëª¨ë“œ ì •ë³´ íŒ¨ë„ */
        #indoorInfoPanel {
            padding: 14px;
            display: none;
            overflow-y: auto;
        }
        #indoorInfoPanel img {
            width: 100%;
            height: auto;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 12px;
        }
        #indoorInfoPanel .title {
            font-size: 18px;
            font-weight: 800;
            margin-bottom: 8px;
            color: #111827;
        }
        #indoorInfoPanel .meta {
            font-size: 14px;
            color: #444;
            margin-bottom: 4px;
        }
        #indoorInfoPanel .section-title {
            margin-top: 18px;
            font-weight: 700;
            font-size: 15px;
            color: #1f2e6a;
            margin-bottom: 8px;
        }
        #indoorInfoPanel .facility-item {
            font-size: 14px;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
        }

        /* ì˜¤ë¥¸ìª½ ì§€ë„ ì˜ì—­: ê¸°ì¡´ ë””ìì¸ ìœ ì§€ ë° ë‚¨ì€ ê³µê°„ ì°¨ì§€ */
        #mapContainer {
            flex-grow: 1; 
            height: 100%;
            position: relative;
        }
        #map {
            width: 100%;
            height: 100%;
        }

        /* coordDisplay */
        #coordDisplay {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2500;
            background: rgba(255,255,255,0.95);
            padding: 8px 16px;
            border-radius: 20px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
            font-size: 14px;
            color: #111827;
            white-space: nowrap;
            max-width: 66%;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
        }

        /* ì§€ë„ ìœ„ ë²„íŠ¼ */
        .map-btn-circle {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: #ffffff;
            border: none;
            box-shadow: 0 3px 10px rgba(0,0,0,0.12);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2200;
        }
        #geolocationBtn {
            position: absolute;
            bottom: 18px;
            left: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: #fff;
            border: 1px solid #ccc;
        }

        #geolocationBtn .geo-icon {
            display: block;
            width: 18px;
            height: 18px;
            border: 2px solid #333; 
            border-radius: 50%;
            position: relative;
            box-sizing: border-box;
        }

        #geolocationBtn .geo-icon::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 4px;
            height: 4px;
            background-color: #333; 
            border-radius: 50%;
        }

        #geolocationBtn.active .geo-icon {
            border: none;
            background-color: transparent;
            width: 0; height: 0;
            transform: rotate(-45deg);
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 12px solid #007bff;
        }

        #geolocationBtn.active .geo-icon::after { content: none; }

        #floorControls {
            position: absolute;
            bottom: 86px;
            left: 18px;
            display: none;
            flex-direction: column-reverse;
            gap: 10px;
            z-index: 2200;
        }

        /* ë°˜ì‘í˜• ìµœì†Œí™” */
        @media (max-width: 920px) {
            #sidebar { display: none; }
        }
    </style>
</head>

<body>
<div id="container">

    <nav id="gnb">
        <div class="gnb-logo">
            <img src="https://raw.githubusercontent.com/candream99/disabledmap/main/pc/name2.png" alt="ë¡œê³ ">
        </div>
        <div class="gnb-menu">
            <button class="gnb-btn active">ğŸ”<span class="btn-text">ê²€ìƒ‰</span></button>
            <button class="gnb-btn">ğŸš©<span class="btn-text">ê¸¸ì°¾ê¸°</span></button>
            <button class="gnb-btn">â­<span class="btn-text">ì¦ê²¨ì°¾ê¸°</span></button>
        </div>
    </nav>

    <aside id="sidebar">
        <div id="searchArea">
            <input id="searchInput" type="text" placeholder="ê²€ìƒ‰â€¦">
        </div>
        <div id="buildingList"></div>
        <div id="indoorInfoPanel"></div>
    </aside>

    <section id="mapContainer">
        <div id="map"></div>
        <div id="coordDisplay">ê±´ë¬¼ì„ í´ë¦­í•˜ë©´ ì‹¤ë‚´ì§€ë„ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”</div>
        <button id="geolocationBtn" class="map-btn-circle">
            <span class="geo-icon"></span>
        </button>
        <div id="floorControls"></div>
    </section>

</div>

<script>
/* ê¸°ì¡´ JavaScript ë¡œì§ ì „ì²´ ë³µì‚¬ (ë°ì´í„° í¬í•¨) */
var NCP_KEY_ID = "q1d23mmkof";
var script = document.createElement("script");
script.src = "https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId="+NCP_KEY_ID+"&vmode=3";

script.onload = function() {

    /* DOM */
    const searchArea = document.getElementById("searchArea");
    const buildingList = document.getElementById("buildingList");
    const searchInput = document.getElementById("searchInput");
    const indoorInfoPanel = document.getElementById("indoorInfoPanel");

    const floorControls = document.getElementById("floorControls");
    const coordDisplay = document.getElementById("coordDisplay");
    const geolocationBtn = document.getElementById("geolocationBtn");

    /* ì§€ë„ ìƒì„± */
    var map = new naver.maps.Map("map", {
        center: new naver.maps.LatLng(37.5710, 126.9784),
        zoom: 17,
        zoomControl: false,
        mapTypes: new naver.maps.MapTypeRegistry({
            normal: naver.maps.NaverStyleMapTypeOptions.getVectorMap(),
        }),
    });
    var labelLayer = new naver.maps.LabelLayer();
    labelLayer.setMap(map);

    var groundOverlay = null;
    var currentBuildingId = null;
    var currentPositionMarker = null;

    /* ì‹¤ë‚´ëª¨ë“œ ì‹œ ì™¼ìª½ íŒ¨ë„ì„ ì •ë³´ íŒ¨ë„ë¡œ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜ */
    function showIndoorInfo(buildingId) {
        const b = buildings[buildingId];
        indoorInfoPanel.innerHTML = `
            <img src="${b.buildingInfo.image_url}">
            <div class="title">${b.buildingInfo.name}</div>
            <div class="meta">ğŸ ï¸ ${b.buildingInfo.address}</div>
            <div class="meta">â—´ ${b.buildingInfo.operating_hours}</div>
            <div class="section-title">ë¬´ì¥ì•  ì‹œì„¤ ì •ë³´</div>
            ${Object.entries(b.accessInfo).map(([k,v]) => `
                <div class="facility-item"><span>â€¢ ${k}</span><span>${v?'ìˆìŒ':'ì—†ìŒ'}</span></div>
            `).join("")}
        `;
    }

    /* ì‹¤ë‚´ëª¨ë“œ ì§„ì… */
    function enterIndoorMode(buildingId){
        currentBuildingId = buildingId;
        searchArea.style.display = "none";
        buildingList.style.display = "none";
        indoorInfoPanel.style.display = "block";
        showIndoorInfo(buildingId);

        const config = buildings[buildingId];
        const bounds = new naver.maps.LatLngBounds();
        config.polygonCoords.forEach(c=>bounds.extend(c));
        map.setCenter(bounds.getCenter());
        map.setZoom(19);

        labelLayer.setMap(null);
        coordDisplay.textContent = "ì¼ë°˜ì§€ë„ë¡œ ëŒì•„ê°€ë ¤ë©´ ì‹¤ë‚´ì§€ë„ë¥¼ í´ë¦­í•˜ì„¸ìš”";
        renderFloorButtons(buildingId);
        floorControls.style.display = "flex";
        showFloor(buildingId, config.currentFloor || "1f");

        for (let id in buildings){
            if (id !== buildingId && buildings[id].polygon){
                buildings[id].polygon.setMap(null);
            }
        }
    }

    /* ì‹¤ë‚´ëª¨ë“œ ì¢…ë£Œ */
    function exitIndoorMode(){
        if (!currentBuildingId) return;
        if (groundOverlay) groundOverlay.setMap(null);
        labelLayer.setMap(map);
        currentBuildingId = null;
        searchArea.style.display = "block";
        buildingList.style.display = "block";
        indoorInfoPanel.style.display = "none";
        floorControls.style.display = "none";
        coordDisplay.textContent = "ê±´ë¬¼ì„ í´ë¦­í•˜ë©´ ì‹¤ë‚´ì§€ë„ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”";
        for (let id in buildings){
            if (buildings[id].polygon){
                buildings[id].polygon.setMap(map);
                buildings[id].polygon.setOptions({ fillColor:"transparent" });
            }
        }
    }

    function showFloor(buildingId, floor){
        const b = buildings[buildingId];
        if (groundOverlay) groundOverlay.setMap(null);
        const img = b.images[floor];
        const bound = b.floorBounds[floor];
        groundOverlay = new naver.maps.GroundOverlay(img, bound, {
            map: map, clickable: true, opacity: 1
        });
        b.currentFloor = floor;
        document.querySelectorAll("#floorControls .floor-btn").forEach(btn=>{
            btn.classList.remove("active");
        });
        const btn = document.querySelector(`#floorControls .floor-btn[data-floor="${floor}"]`);
        if (btn) btn.classList.add("active");
        naver.maps.Event.addListener(groundOverlay,"click",(e)=>{
            e.stopOverlays = true;
            exitIndoorMode();
        });
    }

    function renderFloorButtons(buildingId){
        floorControls.innerHTML = "";
        const b = buildings[buildingId];
        b.floors.forEach(f=>{
            const btn = document.createElement("button");
            btn.className = "floor-btn map-btn-circle";
            btn.dataset.floor = f;
            btn.textContent = f.toUpperCase();
            btn.addEventListener("click", ()=> showFloor(buildingId,f));
            floorControls.prepend(btn);
        });
    }

    /* ì§€ì˜¤ë¡œì¼€ì´ì…˜ */
    geolocationBtn.addEventListener("click",function(){
        if (this.classList.contains("active")){
            if (currentPositionMarker) currentPositionMarker.setMap(null);
            this.classList.remove("active");
            return;
        }
        if (navigator.geolocation){
            navigator.geolocation.getCurrentPosition(pos=>{
                const c = new naver.maps.LatLng(pos.coords.latitude,pos.coords.longitude);
                map.setCenter(c);
                map.setZoom(17);
                if (currentPositionMarker) currentPositionMarker.setMap(null);
                currentPositionMarker = new naver.maps.Marker({ map: map, position: c });
                geolocationBtn.classList.add("active");
            });
        }
    });

    /* ë¹Œë”© ì •ì˜ (ê¸°ì¡´ ë°ì´í„° ìœ ì§€) */
    const buildings = {
        ky: {
            buildingInfo:{
                name:"êµë³´ë¹Œë”©",
                image_url:"https://raw.githubusercontent.com/candream99/disabledmap/main/kb/kyobo_gwanghwamun.jpg",
                address:"ì„œìš¸íŠ¹ë³„ì‹œ ì¢…ë¡œêµ¬ ì¢…ë¡œ 1",
                operating_hours:"09:00 - 18:00"
            },
            accessInfo:{"ì£¼ì¶œì…êµ¬ ê²½ì‚¬ë¡œ":true,"ì¥ì• ì¸ í™”ì¥ì‹¤":false,"ì¥ì• ì¸ ì£¼ì°¨ì¥":true,"ì—˜ë¦¬ë² ì´í„°":true,"ì£¼ì¶œì…êµ¬ ë‹¨ì°¨":false},
            floors:["b1","1f","2f"], currentFloor:"1f",
            images:{"b1":"https://raw.githubusercontent.com/candream99/disabledmap/main/kb/kb_b111.png","1f":"https://raw.githubusercontent.com/candream99/disabledmap/main/kb/ky11.png","2f":"https://raw.githubusercontent.com/candream99/disabledmap/main/kb/ky_1.jpg"},
            floorBounds:{
                "b1":new naver.maps.LatLngBounds(new naver.maps.LatLng(37.571590,126.978531),new naver.maps.LatLng(37.570465,126.977552)),
                "1f":new naver.maps.LatLngBounds(new naver.maps.LatLng(37.570512,126.977632),new naver.maps.LatLng(37.571415,126.978244)),
                "2f":new naver.maps.LatLngBounds(new naver.maps.LatLng(37.570512,126.977632),new naver.maps.LatLng(37.571415,126.978244)),
            },
            polygonCoords:[new naver.maps.LatLng(37.571350,126.977670),new naver.maps.LatLng(37.571360,126.978059),new naver.maps.LatLng(37.571275,126.978063),new naver.maps.LatLng(37.571275,126.978173),new naver.maps.LatLng(37.570870,126.978184),new naver.maps.LatLng(37.570872,126.978082),new naver.maps.LatLng(37.570543,126.978094),new naver.maps.LatLng(37.570539,126.977702)]
        },
        dt: {
            buildingInfo:{name:'ê´‘í™”ë¬¸ Díƒ€ì›Œ',image_url:'https://raw.githubusercontent.com/candream99/disabledmap/main/dt/d_tower.jpg',address:'ì„œìš¸íŠ¹ë³„ì‹œ ì¢…ë¡œêµ¬ ì¢…ë¡œ3ê¸¸ 17',operating_hours:'10:00 - 21:00'},
            accessInfo:{'ì£¼ì¶œì…êµ¬ ê²½ì‚¬ë¡œ':false,'ì¥ì• ì¸ í™”ì¥ì‹¤':true,'ì¥ì• ì¸ ì£¼ì°¨ì¥':false,'ì—˜ë¦¬ë² ì´í„°':true,'ì£¼ì¶œì…êµ¬ ë‹¨ì°¨':true},
            floors:['b4','1f'], currentFloor:'1f',
            images:{'b4':'https://raw.githubusercontent.com/candream99/disabledmap/main/dt/dt_b4.png','1f':'https://raw.githubusercontent.com/candream99/disabledmap/main/dt/dt1.png'},
            floorBounds:{"b4":new naver.maps.LatLngBounds(new naver.maps.LatLng(37.570459,126.978649),new naver.maps.LatLng(37.571626,126.979210)),"1f":new naver.maps.LatLngBounds(new naver.maps.LatLng(37.570459,126.978649),new naver.maps.LatLng(37.571626,126.979210))},
            polygonCoords:[new naver.maps.LatLng(37.571470,126.978762),new naver.maps.LatLng(37.571476,126.979161),new naver.maps.LatLng(37.570627,126.979181),new naver.maps.LatLng(37.570557,126.979117),new naver.maps.LatLng(37.570553,126.978777)]
        }
    };

    /* í´ë¦¬ê³¤ ìƒì„± ë¡œì§ */
    for (let id in buildings) {
        const b = buildings[id];
        b.polygon = new naver.maps.Polygon({
            map: map,
            paths: b.polygonCoords,
            fillColor: "transparent",
            fillOpacity: 0.3,
            strokeColor: "#1f2e6a",
            strokeOpacity: 0.6,
            strokeWeight: 3,
            clickable: true
        });
        naver.maps.Event.addListener(b.polygon, "click", () => enterIndoorMode(id));
        naver.maps.Event.addListener(b.polygon, "mouseover", () => b.polygon.setOptions({ fillColor: "#1f2e6a" }));
        naver.maps.Event.addListener(b.polygon, "mouseout", () => b.polygon.setOptions({ fillColor: "transparent" }));
    }

    /* ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ */
    function renderList(q) {
        const arr = Object.keys(buildings).map(id => ({ id, info: buildings[id].buildingInfo }));
        buildingList.innerHTML = arr.filter(x => {
            if (!q) return true;
            return x.info.name.toLowerCase().includes(q.toLowerCase());
        }).map(x => `
            <div class="building-card" data-id="${x.id}">
                <img class="building-thumb" src="${x.info.image_url}">
                <div class="building-info">
                    <div class="building-name">${x.info.name}</div>
                    <div class="building-meta">ğŸ ï¸ ${x.info.address}</div>
                </div>
            </div>
        `).join("");

        document.querySelectorAll(".building-card").forEach(el => {
            el.onclick = () => enterIndoorMode(el.dataset.id);
        });
    }

    renderList("");
    searchInput.oninput = () => renderList(searchInput.value);
};
document.head.appendChild(script);
</script>
</body>
</html>
